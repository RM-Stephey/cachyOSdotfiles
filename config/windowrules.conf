# ┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
# ┃                    Window Rules                           ┃
# ┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛
#
# ⚠️  HYPRLAND 0.53 UPDATE REQUIRED ⚠️
# Window rule syntax has been completely overhauled in 0.53.
# All windowrules need to be rewritten for the new syntax.
# See: https://wiki.hyprland.org/Configuring/Window-Rules/
#
# This file has been converted, but please verify all rules work correctly
# after upgrading. The new syntax uses a different format for conditions.
#
# For documentation, see:
# https://wiki.hyprland.org/Configuring/Window-Rules/

# -------------------------------------------------------------
# Layer Rules (for Waybar, Quickshell bar, notifications, etc.)
# -------------------------------------------------------------
# ⚠️  HYPRLAND 0.53: layerrule blur syntax - blur needs a value
layerrule = blur on waybar
layerrule = animation slide down waybar

# Waybar auto-hide in fullscreen mode with slide animation
layerrule = animation slide waybar

# Quickshell Waybar (panel) blur & behavior rules (mirrors Waybar)
# Using @quickshell-waybar-replacement namespace
layerrule = blur on @quickshell-waybar-replacement
layerrule = animation slide down @quickshell-waybar-replacement
layerrule = animation slide @quickshell-waybar-replacement
# layerrule = dimaround, waybar  # Removed - was causing dimming

# Wlogout (logout menu) - must be above quickshell
layerrule = blur on wlogout
#layerrule = animation fade wlogout
#layerrule = layer overlay wlogout

# Add blur to swaync for glass effect
layerrule = blur on swaync

# -------------------------------------------------------------
# Global Rules
# -------------------------------------------------------------
# All floating windows will have a different border
# NOTE: Converted from windowrule to windowrulev2 for 0.53 compatibility
windowrulev2 = bordercolor $accent_bright $orange_bright 45deg, floating:1
windowrulev2 = rounding 12, floating:1

# All tiling windows
windowrulev2 = rounding 6, floating:0
windowrulev2 = bordersize 4, floating:0
# Keep borders on all tiled windows for better definition

# Maximized windows - optimized for performance (see fullscreen rules below)
# Note: All fullscreen/maximized windows use performance optimizations (rounding 0, noborder, etc.)

# -------------------------------------------------------------
# Fullscreen Optimization Rules (Fix Mouse Stuttering)
# -------------------------------------------------------------
# Cursor-specific fullscreen rules (must come BEFORE general fullscreen rules)
# PERFORMANCE: Optimize Cursor for fullscreen - disable expensive effects
# Note: Applies to both maximized (fullscreen:1) and true fullscreen (fullscreen:0)
windowrulev2 = immediate, class:^(cursor)$, fullscreen:1
windowrulev2 = immediate, class:^(cursor)$, fullscreen:0
windowrulev2 = noblur, class:^(cursor)$, fullscreen:1
windowrulev2 = noblur, class:^(cursor)$, fullscreen:0
windowrulev2 = noshadow, class:^(cursor)$, fullscreen:1
windowrulev2 = noshadow, class:^(cursor)$, fullscreen:0
windowrulev2 = rounding 0, class:^(cursor)$, fullscreen:1
windowrulev2 = rounding 0, class:^(cursor)$, fullscreen:0
windowrulev2 = noborder, class:^(cursor)$, fullscreen:1
windowrulev2 = noborder, class:^(cursor)$, fullscreen:0
windowrulev2 = opacity 1.0 override, class:^(cursor)$, fullscreen:1
windowrulev2 = opacity 1.0 override, class:^(cursor)$, fullscreen:0

# General fullscreen rules (after app-specific exceptions)
# PERFORMANCE: Disable all expensive effects for fullscreen to enable direct scanout
windowrulev2 = immediate, fullscreen:0
windowrulev2 = noblur, fullscreen:0          # CRITICAL: Disable blur for direct scanout
windowrulev2 = noshadow, fullscreen:0       # CRITICAL: Disable shadows for direct scanout
windowrulev2 = noanim, fullscreen:0
windowrulev2 = rounding 0, fullscreen:0     # CRITICAL: Remove rounding for direct scanout
windowrulev2 = noborder, fullscreen:0       # CRITICAL: Remove borders for direct scanout
windowrulev2 = opacity 1.0 override, fullscreen:0  # CRITICAL: Full opacity for direct scanout

# Separate rules for maximized (fullscreen:1) vs true fullscreen (fullscreen:0)
# fullscreen:0 = true fullscreen, fullscreen:1 = maximize
windowrulev2 = immediate, fullscreen:1
windowrulev2 = noblur, fullscreen:1          # Disable blur for performance
windowrulev2 = noshadow, fullscreen:1       # Disable shadows for performance
windowrulev2 = noanim, fullscreen:1
windowrulev2 = rounding 0, fullscreen:1    # Remove rounding for better performance
windowrulev2 = noborder, fullscreen:1       # Remove borders for better performance
windowrulev2 = opacity 1.0 override, fullscreen:1  # Full opacity for better performance

windowrulev2 = immediate, class:^(steam_app_)(.*)$
windowrulev2 = noblur, class:^(steam_app_)(.*)$
windowrulev2 = noshadow, class:^(steam_app_)(.*)$
windowrulev2 = noanim, class:^(steam_app_)(.*)$

# Video and media applications
windowrulev2 = immediate, class:^(mpv|vlc)$
windowrulev2 = noblur, class:^(mpv|vlc)$
windowrulev2 = noshadow, class:^(mpv|vlc)$

# Browser fullscreen video optimization
windowrulev2 = immediate, title:^(.*(YouTube|Netflix|Twitch|Prime Video).*)$
windowrulev2 = noblur, title:^(.*(YouTube|Netflix|Twitch|Prime Video).*)$
windowrulev2 = noshadow, title:^(.*(YouTube|Netflix|Twitch|Prime Video).*)$

# -------------------------------------------------------------
# Floating Dialogs & Popups
# -------------------------------------------------------------

# System utilities and managers
# NOTE: Converted from windowrule to windowrulev2 for 0.53 compatibility
windowrulev2 = float, class:^(pavucontrol-qt)$
windowrulev2 = float, class:^(blueman-manager)$
windowrulev2 = float, class:^(nm-connection-editor)$
windowrulev2 = float, class:^(CachyOSHello)$
windowrulev2 = float, class:^(zenity)$
windowrulev2 = float, class:^(yad)$
windowrulev2 = float, class:^(xdg-desktop-portal-gtk|xdg-desktop-portal-kde|xdg-desktop-portal-hyprland)(.*)$
windowrulev2 = float, class:^(polkit-gnome-authentication-agent-1|hyprpolkitagent|org.kde.polkit-kde-authentication-agent-1)(.*)$

# Authentication and polkit - always on top
windowrulev2 = stayfocused, class:^(polkit-gnome-authentication-agent-1|hyprpolkitagent|org.kde.polkit-kde-authentication-agent-1)(.*)$
windowrulev2 = pin, class:^(polkit-gnome-authentication-agent-1|hyprpolkitagent|org.kde.polkit-kde-authentication-agent-1)(.*)$

# Utility windows (calculator, color picker, etc.)
windowrulev2 = float, class:^(qalculate-qt)$
windowrulev2 = size 500 700, class:^(qalculate-qt)$
windowrulev2 = center, class:^(qalculate-qt)$
windowrulev2 = pin, class:^(qalculate-qt)$

# KDE/Qt6 File Dialogs - Enhanced Cyberpunk Popup Style
# Match the actual class from portal
windowrulev2 = float, class:^(org\.freedesktop\.impl\.portal\.desktop\.kde)$
windowrulev2 = float, class:^(org\.kde\.kdialog)$
windowrulev2 = center, class:^(org\.freedesktop\.impl\.portal\.desktop\.kde)$
windowrulev2 = center, class:^(org\.kde\.kdialog)$
windowrulev2 = size 70% 65%, class:^(org\.freedesktop\.impl\.portal\.desktop\.kde)$
windowrulev2 = size 70% 65%, class:^(org\.kde\.kdialog)$
windowrulev2 = bordercolor $neon_blue $neon_purple 45deg, class:^(org\.freedesktop\.impl\.portal\.desktop\.kde)$
windowrulev2 = bordercolor $neon_blue $neon_purple 45deg, class:^(org\.kde\.kdialog)$
windowrulev2 = rounding 12, class:^(org\.freedesktop\.impl\.portal\.desktop\.kde)$
windowrulev2 = rounding 12, class:^(org\.kde\.kdialog)$
windowrulev2 = opacity 1.0 0.98, class:^(org\.freedesktop\.impl\.portal\.desktop\.kde)$
windowrulev2 = opacity 1.0 0.98, class:^(org\.kde\.kdialog)$
windowrulev2 = animation popin, class:^(org\.freedesktop\.impl\.portal\.desktop\.kde)$
windowrulev2 = animation popin, class:^(org\.kde\.kdialog)$
windowrulev2 = dimaround, class:^(org\.freedesktop\.impl\.portal\.desktop\.kde)$
windowrulev2 = dimaround, class:^(org\.kde\.kdialog)$
windowrulev2 = stayfocused, class:^(org\.freedesktop\.impl\.portal\.desktop\.kde)$
windowrulev2 = stayfocused, class:^(org\.kde\.kdialog)$
windowrulev2 = noborder, class:^(org\.freedesktop\.impl\.portal\.desktop\.kde)$, floating:0
windowrulev2 = pin, class:^(org\.freedesktop\.impl\.portal\.desktop\.kde)$

# Generic dialog patterns - GTK and other file dialogs
windowrulev2 = float, title:^(Open File|Save File|Save As|Select.*|File Operation.*|Confirm.*|Quit.*|Picture in picture)$
windowrulev2 = float, title:^(Preferences|Settings|About|Error|Warning|Question|Information)$
windowrulev2 = float, title:^(Choose.*|Pick.*|Browse.*)$
windowrulev2 = center, title:^(Open File|Save File|Save As|Select.*|File Operation.*|Confirm.*|Quit.*|Picture in picture)$
windowrulev2 = center, title:^(Preferences|Settings|About|Error|Warning|Question|Information)$
windowrulev2 = size 70% 65%, title:^(Open File|Save File|Save As|Select.*|File Operation.*)$
windowrulev2 = size 60% 70%, title:^(Preferences|Settings)$
windowrulev2 = size 500 300, title:^(Confirm.*|About|Error|Warning|Question|Information)$
windowrulev2 = bordercolor $neon_pink $neon_blue 45deg, title:^(Open File|Save File|Save As)$
windowrulev2 = rounding 10, title:^(Open File|Save File|Save As|Preferences|Settings)$

# Make important dialogs always on top
windowrulev2 = pin, title:^(Error|Warning|Critical)$
windowrulev2 = stayfocused, title:^(Error|Warning|Critical)$

# -------------------------------------------------------------
# Application-Specific Rules
# -------------------------------------------------------------

# --- Terminals ---
# kitty
windowrulev2 = bordercolor $neon_pink $neon_blue 45deg, class:^(kitty)$
windowrulev2 = animation slide, class:^(kitty)$
# wezterm
windowrulev2 = bordercolor $neon_purple $neon_blue 45deg, class:^(org.wezfurlong.wezterm)$
windowrulev2 = opacity 1.0 0.98, class:^(org.wezfurlong.wezterm)$ # Active/inactive opacity
windowrulev2 = animation slide, class:^(org.wezfurlong.wezterm)$

# --- Scratchpad (Kitty) ---
windowrulev2 = float, class:^(term_kitty)$
windowrulev2 = center, class:^(term_kitty)$
windowrulev2 = size 70% 55%, class:^(term_kitty)$
windowrulev2 = bordercolor $neon_green $neon_purple 45deg, class:^(term_kitty)$
windowrulev2 = animation popin, class:^(term_kitty)$
windowrulev2 = rounding 16, class:^(term_kitty)$
windowrulev2 = opacity 1.0 0.98, class:^(term_kitty)$

# --- Scratchpad (Ghostty) ---
# Match com.mitchellh.ghostty (actual Ghostty class) when on special workspace
# Pyprland manages the workspace, we just need to style it
windowrulev2 = float, class:^(term_ghostty)$
windowrulev2 = center, class:^(term_ghostty)$
windowrulev2 = size 75% 60%, class:^(term_ghostty)$
windowrulev2 = bordercolor $neon_pink $neon_blue 45deg, class:^(term_ghostty)$
windowrulev2 = animation popin, class:^(term_ghostty)$
windowrulev2 = rounding 16, class:^(term_ghostty)$
windowrulev2 = opacity 1.0 0.95, class:^(term_ghostty)$

# --- Ghostty (regular windows) ---
windowrulev2 = bordercolor $neon_pink $neon_purple 45deg, class:^(term_ghostty)$
windowrulev2 = animation slide, class:^(term_ghostty)$
windowrulev2 = rounding 8, class:^(term_ghostty)$

# --- File Manager (Thunar) ---
windowrulev2 = float, class:^(pcmanfm-qt)$
windowrulev2 = size 65% 75%, class:^(pcmanfm-qt)$
windowrulev2 = center, class:^(pcmanfm-qt)$
windowrulev2 = bordercolor $neon_blue $neon_green 45deg, class:^(pcmanfm-qt)$
windowrulev2 = opacity 1.0 0.98, class:^(pcmanfm-qt)$
windowrulev2 = animation windowsIn, class:^(pcmanfm-qt)$
windowrulev2 = rounding 8, class:^(pcmanfm-qt)$
# Thunar dialogs
windowrulev2 = float, title:^(File Operation Progress)$
windowrulev2 = float, title:^(Confirm.*)$, class:^(pcmanfm-qt)$

# --- Other Apps ---
# Beeper
windowrulev2 = float, class:^(Beeper)$
windowrulev2 = size 70% 80%, class:^(Beeper)$
windowrulev2 = center, class:^(Beeper)$
windowrulev2 = bordercolor $neon_pink $neon_purple 45deg, class:^(Beeper)$
windowrulev2 = opacity 1.0 0.98, class:^(Beeper)$
windowrulev2 = animation slide, class:^(Beeper)$
windowrulev2 = rounding 10, class:^(Beeper)$
# Beeper Notifications
windowrulev2 = float, title:^(Beeper Notification)$
windowrulev2 = bordercolor $neon_green $neon_blue 45deg, title:^(Beeper Notification)$
windowrulev2 = animation popin, title:^(Beeper Notification)$
windowrulev2 = rounding 16, title:^(Beeper Notification)$

# Ulauncher
windowrulev2 = float, class:^(ulauncher)$
windowrulev2 = stayfocused, class:^(ulauncher)$
windowrulev2 = focusonactivate, class:^(ulauncher)$
windowrulev2 = pin, class:^(ulauncher)$
# windowrulev2 = dimaround, class:^(ulauncher)$  # Removed - was causing dimming
windowrulev2 = noshadow, class:^(ulauncher)$
windowrulev2 = center, class:^(ulauncher)$

# --- 1Password ---
windowrulev2 = float, title:^(1Password.*)$
windowrulev2 = center, title:^(1Password.*)$
windowrulev2 = size 60% 70%, title:^(1Password)$ # Main Window
windowrulev2 = size 50% 50%, title:^(1Password - Quick Access)$ # Quick Access
windowrulev2 = bordercolor $neon_blue $neon_green 45deg, title:^(1Password.*)$
windowrulev2 = rounding 12, title:^(1Password.*)$

# --- Mullvad VPN ---
windowrulev2 = float, class:^(Mullvad VPN)$
windowrulev2 = center, class:^(Mullvad VPN)$

windowrulev2 = bordercolor $neon_purple $neon_pink 45deg, class:^(Mullvad VPN)$
windowrulev2 = rounding 10, class:^(Mullvad VPN)$
windowrulev2 = opacity 1.0 0.98, class:^(Mullvad VPN)$
windowrulev2 = animation slide, class:^(Mullvad VPN)$
# Mullvad dialogs and popups
windowrulev2 = float, title:^(Mullvad.*)$
windowrulev2 = center, title:^(Mullvad.*)$
windowrulev2 = bordercolor $neon_blue $neon_purple 45deg, title:^(Mullvad.*)$
windowrulev2 = rounding 8, title:^(Mullvad.*)$


# --- Cursor AI Code Editor ---
windowrulev2 = bordercolor $neon_blue $neon_purple 45deg, class:^(cursor)$
windowrulev2 = opacity 0.92 override, class:^(cursor)$  # Allow frosted glass effect - override global opacity
windowrulev2 = animation slide, class:^(cursor)$
windowrulev2 = rounding 8, class:^(cursor)$
# Note: Cursor fullscreen opacity rules are in the Fullscreen Optimization section above
# Cursor splash screen
windowrulev2 = float, title:^(Cursor)$, class:^(cursor)$
windowrulev2 = center, title:^(Cursor)$, class:^(cursor)$
windowrulev2 = bordercolor $neon_pink $neon_blue 45deg, title:^(Cursor)$, class:^(cursor)$
windowrulev2 = animation popin, title:^(Cursor)$, class:^(cursor)$
windowrulev2 = rounding 12, title:^(Cursor)$, class:^(cursor)$
# Cursor dialogs and popups
windowrulev2 = float, title:^(Open Folder|Select Folder|Save|Extension|Settings)$, class:^(cursor)$
windowrulev2 = center, title:^(Open Folder|Select Folder|Save|Extension|Settings)$, class:^(cursor)$
windowrulev2 = size 60% 70%, title:^(Open Folder|Select Folder|Save|Extension|Settings)$, class:^(cursor)$
windowrulev2 = bordercolor $neon_green $neon_purple 45deg, title:^(Open Folder|Select Folder|Save|Extension|Settings)$, class:^(cursor)$
windowrulev2 = rounding 10, title:^(Open Folder|Select Folder|Save|Extension|Settings)$, class:^(cursor)$

layerrule = blur on swaync-control-center
layerrule = blur on swaync-notification-window
# ignorezero and ignorealpha removed - not valid in 0.53

# Enhanced pavucontrol rules with borders (consolidated - removed duplicate float rule)
# NOTE: Converted from windowrule to windowrulev2 for 0.53 compatibility
windowrulev2 = size 900 600, class:^(pavucontrol-qt)$
windowrulev2 = center, class:^(pavucontrol-qt)$
windowrulev2 = rounding 12, class:^(pavucontrol-qt)$
windowrulev2 = bordersize 3, class:^(pavucontrol-qt)$
windowrulev2 = opacity 0.88 0.85, class:^(pavucontrol-qt)$
windowrulev2 = animation slide, class:^(pavucontrol-qt)$
layerrule = blur on pavucontrol-qt

# Screenshot selection rules - prevent windows from hiding
windowrulev2 = nofocus, class:^(slurp)$
windowrulev2 = float, class:^(slurp)$
windowrulev2 = pin, class:^(slurp)$
windowrulev2 = stayfocused, class:^(slurp)$
# noanim removed - not valid for layerrule in 0.53

# -------------------------------------------------------------
# Smart Window Type Detection (Generic Patterns)
# -------------------------------------------------------------

# Detect dialogs by window type
windowrulev2 = float, xwayland:1, title:^$  # Empty title XWayland dialogs
windowrulev2 = center, xwayland:1, title:^$

# Splash screens should float and center
windowrulev2 = float, class:.*,title:^(splash)$
windowrulev2 = center, class:.*,title:^(splash)$
windowrulev2 = noanim, class:.*,title:^(splash)$

# Pop-up windows (typically small utility windows)
windowrulev2 = float, class:.*,title:^(pop-up)$
windowrulev2 = float, class:.*,title:^(bubble)$
windowrulev2 = float, class:.*,title:^(task_dialog)$
windowrulev2 = float, class:.*,title:^(menu)$
windowrulev2 = float, class:.*,title:^(dropdown.*)$

# Picture-in-Picture should always stay on top
windowrulev2 = pin, title:^(Picture.in.[Pp]icture)$
windowrulev2 = keepaspectratio, title:^(Picture.in.[Pp]icture)$
windowrulev2 = float, title:^(Picture.in.[Pp]icture)$
windowrulev2 = size 25% 25%, title:^(Picture.in.[Pp]icture)$
windowrulev2 = move 74% 74%, title:^(Picture.in.[Pp]icture)$  # Bottom right corner
