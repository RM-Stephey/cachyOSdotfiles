# ┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
# ┃                    Window Rules                           ┃
# ┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛
#
# Updated for Hyprland 0.53+ (new windowrule / layerrule syntax)
# Reference: https://wiki.hypr.land/Configuring/Window-Rules/

# -------------------------------------------------------------
# Layer Rules (for Waybar, Quickshell bar, notifications, etc.)
# Note: Hyprland treats layerrule as a special category whose key is `name`.
# The key must appear first; using bracket syntax avoids ordering issues.
# -------------------------------------------------------------
layerrule[waybar-layer] {
    match:namespace = waybar
    blur = on
    animation = slide
}

layerrule[quickshell-layer] {
    match:namespace = @quickshell-waybar-replacement
    blur = on
    animation = slide
}

layerrule[wlogout-layer] {
    match:namespace = wlogout
    blur = on
    animation = fade
    order = 10
}

layerrule[swaync-layer] {
    match:namespace = swaync
    blur = on
}
layerrule[swaync-control-center-layer] {
    match:namespace = swaync-control-center
    blur = on
}
layerrule[swaync-notification-layer] {
    match:namespace = swaync-notification-window
    blur = on
}

# -------------------------------------------------------------
# Global Rules
# -------------------------------------------------------------
windowrule {
    name = floating-style
    match:float = true
    border_color = $neon_pink $neon_blue 45deg  # brighter animated gradient instead of terracotta
    animation = slide
    rounding = 12
}

windowrule {
    name = tiled-style
    match:float = false
    rounding = 6
    border_size = 4
}

# Maximized windows - optimized for performance (see fullscreen rules below)
# Note: All fullscreen/maximized windows use performance optimizations (rounding 0, border_size 0, etc.)

# -------------------------------------------------------------
# Fullscreen Optimization Rules (Fix Mouse Stuttering)
# -------------------------------------------------------------
windowrule {
    name = fullscreen-cursor
    match:class = ^(cursor)$
    match:fullscreen = true
    immediate = true
    no_blur = true
    no_shadow = true
    rounding = 0
    border_size = 0
    opacity = 1.0 override
}

windowrule {
    name = fullscreen-global
    match:fullscreen = true
    immediate = true
    no_blur = true
    no_shadow = true
    no_anim = true
    rounding = 0
    border_size = 0
    opacity = 1.0 override
}

windowrule {
    name = maximize-global
    match:fullscreen_state_internal = 1
    immediate = true
    no_blur = true
    no_shadow = true
    no_anim = true
    rounding = 0
    border_size = 0
    opacity = 1.0 override
}

windowrule {
    name = fullscreen-steam
    match:class = ^(steam_app_)(.*)$
    match:fullscreen = true
    immediate = true
    no_blur = true
    no_shadow = true
    no_anim = true
}

windowrule {
    name = fullscreen-video
    match:class = ^(mpv|vlc)$
    match:fullscreen = true
    immediate = true
    no_blur = true
    no_shadow = true
}

windowrule {
    name = fullscreen-browser-video
    match:title = ^.*(YouTube|Netflix|Twitch|Prime Video).*
    match:fullscreen = true
    immediate = true
    no_blur = true
    no_shadow = true
}

# -------------------------------------------------------------
# Floating Dialogs & Popups
# -------------------------------------------------------------

windowrule {
    name = "pavucontrol-qt"
    match:class = ^pavucontrol-qt$
    float = true
    size = 50% 60%
    center = true
    border_color = $neon_pink $neon_blue 45deg
    border_size = 3
    rounding = 12
    opacity = 0.88 0.85
    animation = slide
}

windowrule {
    name = "blueman-manager"
    match:class = ^blueman-manager$
    float = true
}

windowrule {
    name = "nm-connection-editor"
    match:class = ^nm-connection-editor$
    float = true
}

windowrule { name = "CachyOSHello"; match:class = ^CachyOSHello$; float = true }
windowrule { name = "zenity"; match:class = ^zenity$; float = true }
windowrule { name = "yad"; match:class = ^yad$; float = true }
windowrule { name = "xdg-desktop-portal-gtk"; match:class = ^xdg-desktop-portal-gtk$; float = true }
windowrule { name = "xdg-desktop-portal-kde"; match:class = ^xdg-desktop-portal-kde$; float = true }
windowrule { name = "xdg-desktop-portal-hyprland"; match:class = ^xdg-desktop-portal-hyprland$; float = true }

windowrule {
    name = "polkit-agents"
    match:class = ^polkit-gnome-authentication-agent-1$
    float = true
    stay_focused = true
    pin = true
}

windowrule {
    name = "hyprpolkitagent"
    match:class = ^hyprpolkitagent$
    float = true
    stay_focused = true
    pin = true
}

windowrule {
    name = "polkit-kde-agent"
    match:class = ^org.kde.polkit-kde-authentication-agent-1$
    float = true
    stay_focused = true
    pin = true
}

# Utility windows (calculator, color picker, etc.)
windowrule {
    name = "qalculate-qt"
    match:class = ^qalculate-qt$
    float = true
    size = 40% 70%
    center = true
    pin = true
}

# KDE/Qt6 File Dialogs - Enhanced Cyberpunk Popup Style
windowrule {
    name = "kde-portal-dialog"
    match:class = org.freedesktop.impl.portal.desktop.kde
    float = true
    center = true
    size = 55% 60%
    border_color = $neon_blue $neon_purple 45deg
    rounding = 12
    opacity = 1.0 0.98
    animation = popin
    dim_around = true
    stay_focused = true
    pin = true
}

windowrule {
    name = "kde-kdialog"
    match:class = org.kde.kdialog
    float = true
    center = true
    size = 55% 60%
    border_color = $neon_blue $neon_purple 45deg
    rounding = 12
    opacity = 1.0 0.98
    animation = popin
    dim_around = true
    stay_focused = true
}

# Generic dialog patterns - GTK and other file dialogs
# Using windowrulev2 for regex title matching
# windowrulev2 = float, title:^(Open File|Save File|Save As|Select.*|File Operation.*|Confirm.*|Quit.*|Picture in picture)$
# windowrulev2 = center, title:^(Open File|Save File|Save As|Select.*|File Operation.*|Confirm.*|Quit.*|Picture in picture)$
# windowrulev2 = size 50% 60%, title:^(Open File|Save File|Save As|Select.*|File Operation.*)$
# windowrulev2 = bordercolor $neon_pink $neon_blue 45deg, title:^(Open File|Save File|Save As)$
# windowrulev2 = rounding 10, title:^(Open File|Save File|Save As|Preferences|Settings)$

# windowrulev2 = float, title:^(Preferences|Settings|About|Error|Warning|Question|Information)$
# windowrulev2 = center, title:^(Preferences|Settings|About|Error|Warning|Question|Information)$
# windowrulev2 = size 50% 60%, title:^(Preferences|Settings)$
windowrule {
    name = "generic-confirm-dialog"
    match:title = ^(Confirm.*|About|Error|Warning|Question|Information)$
    float = true
    center = true
    size = 450 350
}

windowrule {
    name = "pickers_and_choosers"
    match:title = ^(Preferences|Settings|About|Error|Warning|Question|Information)$
    center = true
    size = 50% 60%
}


# windowrulev2 = float, title:^(Choose.*|Pick.*|Browse.*)$
# windowrulev2 = center, title:^(Choose.*|Pick.*|Browse.*)$
# windowrulev2 = size 45% 55%, title:^(Choose.*|Pick.*|Browse.*)$

windowrule {
    name = "pickers_and_choosers"
    match:title = ^(Choose.*|Pick.*|Browse.*)$
    center = true
    size = 45% 55%
}

# Make important dialogs always on top
# windowrulev2 = pin, title:^(Error|Warning|Critical)$
# windowrulev2 = stay_focused, title:^(Error|Warning|Critical)$

windowrule {
    name = "important_Dialogs"
    match:title = ^(Error|Warning|Critical)$
    pin = true
    stay_focused = true
    float = true
    center = true
    dim_around = true
}

# -------------------------------------------------------------
# Application-Specific Rules
# -------------------------------------------------------------

# --- Terminals ---
windowrule {
    name = "kitty"
    match:class = ^kitty$
    border_color = $neon_pink $neon_blue 45deg
    animation = slide
}

windowrule {
    name = "wezterm"
    match:class = ^org.wezfurlong.wezterm$
    border_color = $neon_purple $neon_blue 45deg
    opacity = 1.0 0.98
    animation = slide
}

# --- Scratchpad (Kitty) ---
windowrule {
    name = "scratchpad-kitty"
    match:class = ^term_kitty$
    float = true
    center = true
    size = 70% 55%
    border_color = $neon_green $neon_purple 45deg
    animation = popin
    rounding = 16
    opacity = 1.0 0.98
}

# --- Scratchpad (Ghostty) ---
windowrule {
    name = "scratchpad-ghostty"
    match:class = ^com.mitchellh.ghostty$
    float = true
    size = 75% 60%
    border_color = $neon_pink $neon_blue 45deg
    center = true
    animation = popin
    rounding = 16
    opacity = 1.0 0.95
}

# --- Ghostty (regular windows) ---
# windowrule {
#     name = "ghostty-regular"
#     match:class = com.mitchellh.ghostty
#     border_color = $neon_pink $neon_purple 45deg
#     animation = slide
#     rounding = 8
# }

# --- File Manager (PCManFM-Qt) ---
# NOTE: Detailed rules are in pcmanfm_enhanced_fixed.conf (sourced via user-config.conf)
# NOTE: Hyprland 0.53 syntax - using windowrule (not windowrulev2) for float
# Base rules here ensure floating works even if enhanced config fails to load


# PCManFM-Qt dialogs
#Previous rules:
# windowrulev2 = float, class:^(pcmanfm-qt)$
# windowrulev2 = size 65% 75%, class:^(pcmanfm-qt)$
# windowrulev2 = center, class:^(pcmanfm-qt)$
windowrule {
    name = "pcmanfm-qt"
    match:class = ^pcmanfm-qt$
    float = true
    size = 55% 65%
    border_color = $neon_pink $neon_blue 45deg
    border_size = 3
    center = true
    opacity = 1.0 0.98
    animation = slide
    rounding = 12
}

# --- Other Apps ---
windowrule {
    name = "beeper"
    match:class = ^Beeper$
    float = true
    size = 55% 70%
    center = true
    border_color = $neon_pink $neon_purple 45deg
    opacity = 1.0 0.98
    animation = slide
    rounding = 10
}

# Beeper Notifications - using windowrulev2 for title matching
windowrule {
    name = "beeper-notification"
    match:title = ^(Beeper Notification)$
    float = true
    border_color = $neon_green $neon_blue 45deg
    animation = popin
    rounding = 16
}

windowrule {
    name = "ulauncher"
    match:class = ^ulauncher$
    float = true
    stay_focused = true
    focus_on_activate = true
    pin = true
    no_shadow = true
    center = true
}

# --- 1Password ---
windowrule {
    name = "1password-main"
    match:class = ^1Password$
    float = true
    center = true
    size = 20% 30%
    border_color = $neon_blue $neon_green 45deg
    rounding = 12
}

windowrule {
    name = "1password-quick-access"
    match:title = 1Password - Quick Access
    float = true
    center = true
    size = 40% 45%
    border_color = $neon_blue $neon_green 45deg
    rounding = 12
}

# # Fallback for other 1Password windows
# windowrulev2 = float, title:^(1Password.*)$
# windowrulev2 = center, title:^(1Password.*)$
# windowrulev2 = bordercolor $neon_blue $neon_green 45deg, title:^(1Password.*)$
# windowrulev2 = rounding 12, title:^(1Password.*)$



# Mullvad dialogs and popups - using windowrulev2 for title regex
# windowrulev2 = float, title:^(Mullvad.*)$
# windowrulev2 = center, title:^(Mullvad.*)$
# windowrulev2 = bordercolor $neon_blue $neon_purple 45deg, title:^(Mullvad.*)$
# windowrulev2 = rounding 8, title:^(Mullvad.*)$

windowrule {
    name = "mullvad-vpn"
    match:class = ^Mullvad VPN$
    float = true
    center = true
    size = 50% 65%
    border_color = $neon_purple $neon_pink 45deg
    rounding = 10
    opacity = 1.0 0.98
    animation = slide
}

# --- Cursor AI Code Editor ---
windowrule {
    name = "cursor"
    match:class = ^cursor$
    border_color = $neon_blue $neon_purple 45deg
    opacity = 0.92 override
    animation = slide
    rounding = 8
}

# Cursor splash screen - using windowrulev2 for title+class matching
# windowrulev2 = float, title:^(Cursor)$, class:^(cursor)$
# windowrulev2 = center, title:^(Cursor)$, class:^(cursor)$
# windowrulev2 = bordercolor $neon_pink $neon_blue 45deg, title:^(Cursor)$, class:^(cursor)$
# windowrulev2 = animation popin, title:^(Cursor)$, class:^(cursor)$
# windowrulev2 = rounding 12, title:^(Cursor)$, class:^(cursor)$

# Cursor dialogs and popups - using windowrulev2 for title+class matching
# windowrulev2 = float, title:^(Open Folder|Select Folder|Save|Extension|Settings)$, class:^(cursor)$
# windowrulev2 = center, title:^(Open Folder|Select Folder|Save|Extension|Settings)$, class:^(cursor)$
# windowrulev2 = size 50% 60%, title:^(Open Folder|Select Folder|Save|Extension|Settings)$, class:^(cursor)$
# windowrulev2 = bordercolor $neon_green $neon_purple 45deg, title:^(Open Folder|Select Folder|Save|Extension|Settings)$, class:^(cursor)$
# windowrulev2 = rounding 10, title:^(Open Folder|Select Folder|Save|Extension|Settings)$, class:^(cursor)$

# ignorezero and ignorealpha removed - not valid in 0.53
# Old-style layerrules removed - now handled by block syntax above
#

windowrule {
    name = "cursor_dialogs"
    match:title = ^(Open Folder|Select Folder|Save|Extension|Settings)$
    match:class = ^cursor$
    size = 50% 60%
    border_color = $neon_green $neon_purple 45deg
    rounding = 10
}

windowrule {
    name = "slurp"
    match:class = ^slurp$
    no_focus = true
    float = true
    pin = true
    stay_focused = true
}

# -------------------------------------------------------------
# Smart Window Type Detection (Generic Patterns)
# -------------------------------------------------------------
# Detect dialogs by window type
windowrule { name = "xwayland-empty-title"; match:xwayland = true; match:title = ^$; float = true; center = true }

# Splash screens should float and center
windowrule { name = "splash"; match:title = ^(splash)$; float = true; center = true; no_anim = true }

# Pop-up windows (typically small utility windows)
# windowrulev2 = float, class: .*, title:^(pop-up)$
# windowrulev2 = float, class: .*, title:^(bubble)$
# windowrulev2 = float, class: .*, title:^(task_dialog)$
# windowrulev2 = float, class: .*, title:^(menu)$
# windowrulev2 = float, class: .*, title:^(dropdown.*)$

windowrule {
    name = "Popup"
    match:class = .*
    match:title = ^(pop-up|bubble|task_dialog|menu|dropdown.*)$
    float = true
}

windowrule {
    name = "PinP"
    match:title = ^(Picture.in.[Pp]icture)$
    keep_aspect_ratio = true
    no_focus = true
    size = 25% 25%
    move = 74% 74%
    float = true
    pin = true

}
