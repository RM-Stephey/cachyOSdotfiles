# ┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
# ┃                    Window Rules                           ┃
# ┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛
#
# ⚠️  HYPRLAND 0.53 UPDATE REQUIRED ⚠️
# Window rule syntax has been completely overhauled in 0.53.
# All windowrules need to be rewritten for the new syntax.
# See: https://wiki.hyprland.org/Configuring/Window-Rules/
#
# This file has been converted, but please verify all rules work correctly
# after upgrading. The new syntax uses a different format for conditions.
#
# For documentation, see:
# https://wiki.hyprland.org/Configuring/Window-Rules/

# -------------------------------------------------------------
# Layer Rules (for Waybar, Quickshell bar, notifications, etc.)
# -------------------------------------------------------------
# ⚠️  HYPRLAND 0.53: layerrule blur syntax - blur needs a value
layerrule = blur on waybar
layerrule = animation slide down waybar

# Waybar auto-hide in fullscreen mode with slide animation
layerrule = animation slide waybar

# Quickshell Waybar (panel) blur & behavior rules (mirrors Waybar)
# Using @quickshell-waybar-replacement namespace
layerrule = blur on @quickshell-waybar-replacement
layerrule = animation slide down @quickshell-waybar-replacement
layerrule = animation slide @quickshell-waybar-replacement
# layerrule = dim_around, waybar  # Removed - was causing dimming

# Wlogout (logout menu) - must be above quickshell
layerrule = blur on wlogout
#layerrule = animation fade wlogout
#layerrule = layer overlay wlogout

# Add blur to swaync for glass effect
layerrule = blur on swaync

# -------------------------------------------------------------
# Global Rules
# -------------------------------------------------------------
# All floating windows will have a different border
# NOTE: Converted from windowrule to windowrulev2 for 0.53 compatibility
windowrulev2 = bordercolor $accent_bright $orange_bright 45deg, floating:1
windowrulev2 = rounding 12, floating:1

# All tiling windows
windowrulev2 = rounding 6, floating:0
windowrulev2 = border_size 4, floating:0
# Keep borders on all tiled windows for better definition

# Maximized windows - optimized for performance (see fullscreen rules below)
# Note: All fullscreen/maximized windows use performance optimizations (rounding 0, noborder, etc.)

# -------------------------------------------------------------
# Fullscreen Optimization Rules (Fix Mouse Stuttering)
# -------------------------------------------------------------
# Cursor-specific fullscreen rules (must come BEFORE general fullscreen rules)
# PERFORMANCE: Optimize Cursor for fullscreen - disable expensive effects
# Note: Applies to both maximized (fullscreen:1) and true fullscreen (fullscreen:0)
windowrulev2 = immediate, class:^(cursor)$, fullscreen:1
windowrulev2 = immediate, class:^(cursor)$, fullscreen:0
windowrulev2 = noblur, class:^(cursor)$, fullscreen:1
windowrulev2 = noblur, class:^(cursor)$, fullscreen:0
windowrulev2 = no_shadow, class:^(cursor)$, fullscreen:1
windowrulev2 = no_shadow, class:^(cursor)$, fullscreen:0
windowrulev2 = rounding 0, class:^(cursor)$, fullscreen:1
windowrulev2 = rounding 0, class:^(cursor)$, fullscreen:0
windowrulev2 = noborder, class:^(cursor)$, fullscreen:1
windowrulev2 = noborder, class:^(cursor)$, fullscreen:0
windowrulev2 = opacity 1.0 override, class:^(cursor)$, fullscreen:1
windowrulev2 = opacity 1.0 override, class:^(cursor)$, fullscreen:0

# General fullscreen rules (after app-specific exceptions)
# PERFORMANCE: Disable all expensive effects for fullscreen to enable direct scanout
windowrulev2 = immediate, fullscreen:0
windowrulev2 = noblur, fullscreen:0          # CRITICAL: Disable blur for direct scanout
windowrulev2 = no_shadow, fullscreen:0       # CRITICAL: Disable shadows for direct scanout
windowrulev2 = noanim, fullscreen:0
windowrulev2 = rounding 0, fullscreen:0     # CRITICAL: Remove rounding for direct scanout
windowrulev2 = noborder, fullscreen:0       # CRITICAL: Remove borders for direct scanout
windowrulev2 = opacity 1.0 override, fullscreen:0  # CRITICAL: Full opacity for direct scanout

# Separate rules for maximized (fullscreen:1) vs true fullscreen (fullscreen:0)
# fullscreen:0 = true fullscreen, fullscreen:1 = maximize
windowrulev2 = immediate, fullscreen:1
windowrulev2 = noblur, fullscreen:1          # Disable blur for performance
windowrulev2 = no_shadow, fullscreen:1       # Disable shadows for performance
windowrulev2 = noanim, fullscreen:1
windowrulev2 = rounding 0, fullscreen:1    # Remove rounding for better performance
windowrulev2 = noborder, fullscreen:1       # Remove borders for better performance
windowrulev2 = opacity 1.0 override, fullscreen:1  # Full opacity for better performance

windowrulev2 = immediate, class:^(steam_app_)(.*)$
windowrulev2 = noblur, class:^(steam_app_)(.*)$
windowrulev2 = no_shadow, class:^(steam_app_)(.*)$
windowrulev2 = noanim, class:^(steam_app_)(.*)$

# Video and media applications
windowrulev2 = immediate, class:^(mpv|vlc)$
windowrulev2 = noblur, class:^(mpv|vlc)$
windowrulev2 = no_shadow, class:^(mpv|vlc)$

# Browser fullscreen video optimization
windowrulev2 = immediate, title:^(.*(YouTube|Netflix|Twitch|Prime Video).*)$
windowrulev2 = noblur, title:^(.*(YouTube|Netflix|Twitch|Prime Video).*)$
windowrulev2 = no_shadow, title:^(.*(YouTube|Netflix|Twitch|Prime Video).*)$

# -------------------------------------------------------------
# Floating Dialogs & Popups
# -------------------------------------------------------------

# System utilities and managers
# NOTE: Hyprland 0.53 syntax - using named windowrule blocks
# NOTE: Must be early in rules to ensure floating takes precedence

windowrule {
    name = "pavucontrol-qt"
    match:class = pavucontrol-qt
    float = true
    size = 50% 60%
    center = true
    border_color = $neon_pink $neon_blue 45deg
    border_size = 3
    rounding = 12
    opacity = 0.88 0.85
    animation = slide
}

windowrule {
    name = "blueman-manager"
    match:class = blueman-manager
    float = true
}

windowrule {
    name = "nm-connection-editor"
    match:class = nm-connection-editor
    float = true
}

windowrule {
    name = "CachyOSHello"
    match:class = CachyOSHello
    float = true
}

windowrule {
    name = "zenity"
    match:class = zenity
    float = true
}

windowrule {
    name = "yad"
    match:class = yad
    float = true
}

windowrule {
    name = "xdg-desktop-portals"
    match:class = xdg-desktop-portal-gtk
    float = true
}

windowrule {
    name = "xdg-desktop-portal-kde"
    match:class = xdg-desktop-portal-kde
    float = true
}

windowrule {
    name = "xdg-desktop-portal-hyprland"
    match:class = xdg-desktop-portal-hyprland
    float = true
}

windowrule {
    name = "polkit-agents"
    match:class = polkit-gnome-authentication-agent-1
    float = true
    stay_focused = true
    pin = true
}

windowrule {
    name = "hyprpolkitagent"
    match:class = hyprpolkitagent
    float = true
    stay_focused = true
    pin = true
}

windowrule {
    name = "polkit-kde-agent"
    match:class = org.kde.polkit-kde-authentication-agent-1
    float = true
    stay_focused = true
    pin = true
}

# Utility windows (calculator, color picker, etc.)
windowrule {
    name = "qalculate-qt"
    match:class = qalculate-qt
    float = true
    size = 40% 70%
    center = true
    pin = true
}

# KDE/Qt6 File Dialogs - Enhanced Cyberpunk Popup Style
windowrule {
    name = "kde-portal-dialog"
    match:class = org.freedesktop.impl.portal.desktop.kde
    float = true
    center = true
    size = 55% 60%
    border_color = $neon_blue $neon_purple 45deg
    rounding = 12
    opacity = 1.0 0.98
    animation = popin
    dim_around = true
    stay_focused = true
    pin = true
}

windowrule {
    name = "kde-kdialog"
    match:class = org.kde.kdialog
    float = true
    center = true
    size = 55% 60%
    border_color = $neon_blue $neon_purple 45deg
    rounding = 12
    opacity = 1.0 0.98
    animation = popin
    dim_around = true
    stay_focused = true
}

# Generic dialog patterns - GTK and other file dialogs
# Using windowrulev2 for regex title matching
# windowrulev2 = float, title:^(Open File|Save File|Save As|Select.*|File Operation.*|Confirm.*|Quit.*|Picture in picture)$
# windowrulev2 = center, title:^(Open File|Save File|Save As|Select.*|File Operation.*|Confirm.*|Quit.*|Picture in picture)$
# windowrulev2 = size 50% 60%, title:^(Open File|Save File|Save As|Select.*|File Operation.*)$
# windowrulev2 = bordercolor $neon_pink $neon_blue 45deg, title:^(Open File|Save File|Save As)$
# windowrulev2 = rounding 10, title:^(Open File|Save File|Save As|Preferences|Settings)$

# windowrulev2 = float, title:^(Preferences|Settings|About|Error|Warning|Question|Information)$
# windowrulev2 = center, title:^(Preferences|Settings|About|Error|Warning|Question|Information)$
# windowrulev2 = size 50% 60%, title:^(Preferences|Settings)$
windowrulev2 = size 450 350, title:^(Confirm.*|About|Error|Warning|Question|Information)$

windowrule {
    name = "pickers_and_choosers"
    match:title = ^(Preferences|Settings|About|Error|Warning|Question|Information)$
    center = true
    size = 50% 60%

}


# windowrulev2 = float, title:^(Choose.*|Pick.*|Browse.*)$
# windowrulev2 = center, title:^(Choose.*|Pick.*|Browse.*)$
# windowrulev2 = size 45% 55%, title:^(Choose.*|Pick.*|Browse.*)$

windowrule {
    name = "pickers_and_choosers"
    match:title = ^(Choose.*|Pick.*|Browse.*)$
    center = true
    size = 45% 55%

}

# Make important dialogs always on top
# windowrulev2 = pin, title:^(Error|Warning|Critical)$
# windowrulev2 = stay_focused, title:^(Error|Warning|Critical)$

windowrule {
    name = "important_Dialogs"
    match:title = ^(Error|Warning|Critical)$
    pin = true
    stay_focused = true
}

# -------------------------------------------------------------
# Application-Specific Rules
# -------------------------------------------------------------

# --- Terminals ---
windowrule {
    name = "kitty"
    match:class = kitty
    border_color = $neon_pink $neon_blue 45deg
    animation = slide
}

windowrule {
    name = "wezterm"
    match:class = org.wezfurlong.wezterm
    border_color = $neon_purple $neon_blue 45deg
    opacity = 1.0 0.98
    animation = slide
}

# --- Scratchpad (Kitty) ---
windowrule {
    name = "scratchpad-kitty"
    match:class = term_kitty
    float = true
    center = true
    size = 70% 55%
    border_color = $neon_green $neon_purple 45deg
    animation = popin
    rounding = 16
    opacity = 1.0 0.98
}

# --- Scratchpad (Ghostty) ---
windowrule {
    name = "scratchpad-ghostty"
    match:class = com.mitchellh.ghostty
    float = true
    size = 75% 60%
    border_color = $neon_pink $neon_blue 45deg
    center = true
    animation = popin
    rounding = 16
    opacity = 1.0 0.95
}

# --- Ghostty (regular windows) ---
# windowrule {
#     name = "ghostty-regular"
#     match:class = com.mitchellh.ghostty
#     border_color = $neon_pink $neon_purple 45deg
#     animation = slide
#     rounding = 8
# }

# --- File Manager (PCManFM-Qt) ---
# NOTE: Detailed rules are in pcmanfm_enhanced_fixed.conf (sourced via user-config.conf)
# NOTE: Hyprland 0.53 syntax - using windowrule (not windowrulev2) for float
# Base rules here ensure floating works even if enhanced config fails to load


# PCManFM-Qt dialogs
#Previous rules:
# windowrulev2 = float, class:^(pcmanfm-qt)$
# windowrulev2 = size 65% 75%, class:^(pcmanfm-qt)$
# windowrulev2 = center, class:^(pcmanfm-qt)$
windowrule {
    name = "pcmanfm-qt"
    match:class = pcmanfm-qt
    float = true
    size = 55% 65%
    border_color = $neon_pink $neon_blue 45deg
    border_size = 3
    center = true
    opacity = 1.0 0.98
    animation = slide
    rounding = 12
}

# --- Other Apps ---
windowrule {
    name = "beeper"
    match:class = Beeper
    float = true
    size = 55% 70%
    center = true
    border_color = $neon_pink $neon_purple 45deg
    opacity = 1.0 0.98
    animation = slide
    rounding = 10
}

# Beeper Notifications - using windowrulev2 for title matching
windowrulev2 = float, title:^(Beeper Notification)$
windowrulev2 = bordercolor $neon_green $neon_blue 45deg, title:^(Beeper Notification)$
windowrulev2 = animation popin, title:^(Beeper Notification)$
windowrulev2 = rounding 16, title:^(Beeper Notification)$

windowrule {
    name = "ulauncher"
    match:class = ulauncher
    float = true
    stay_focused = true
    focus_on_activate = true
    pin = true
    no_shadow = true
    center = true
}

# --- 1Password ---
windowrule {
    name = "1password-main"
    match:class = 1Password
    float = true
    center = true
    size = 20% 30%
    border_color = $neon_blue $neon_green 45deg
    rounding = 12
}

windowrule {
    name = "1password-quick-access"
    match:title = 1Password - Quick Access
    float = true
    center = true
    size = 40% 45%
    border_color = $neon_blue $neon_green 45deg
    rounding = 12
}

# # Fallback for other 1Password windows
# windowrulev2 = float, title:^(1Password.*)$
# windowrulev2 = center, title:^(1Password.*)$
# windowrulev2 = bordercolor $neon_blue $neon_green 45deg, title:^(1Password.*)$
# windowrulev2 = rounding 12, title:^(1Password.*)$



# Mullvad dialogs and popups - using windowrulev2 for title regex
# windowrulev2 = float, title:^(Mullvad.*)$
# windowrulev2 = center, title:^(Mullvad.*)$
# windowrulev2 = bordercolor $neon_blue $neon_purple 45deg, title:^(Mullvad.*)$
# windowrulev2 = rounding 8, title:^(Mullvad.*)$

windowrule {
    name = "mullvad-vpn"
    match:class = Mullvad VPN
    float = true
    center = true
    size = 50% 65%
    border_color = $neon_purple $neon_pink 45deg
    rounding = 10
    opacity = 1.0 0.98
    animation = slide
}

# --- Cursor AI Code Editor ---
windowrule {
    name = "cursor"
    match:class = cursor
    border_color = $neon_blue $neon_purple 45deg
    opacity = 0.92 override
    animation = slide
    rounding = 8
}

# Cursor splash screen - using windowrulev2 for title+class matching
# windowrulev2 = float, title:^(Cursor)$, class:^(cursor)$
# windowrulev2 = center, title:^(Cursor)$, class:^(cursor)$
# windowrulev2 = bordercolor $neon_pink $neon_blue 45deg, title:^(Cursor)$, class:^(cursor)$
# windowrulev2 = animation popin, title:^(Cursor)$, class:^(cursor)$
# windowrulev2 = rounding 12, title:^(Cursor)$, class:^(cursor)$

# Cursor dialogs and popups - using windowrulev2 for title+class matching
# windowrulev2 = float, title:^(Open Folder|Select Folder|Save|Extension|Settings)$, class:^(cursor)$
# windowrulev2 = center, title:^(Open Folder|Select Folder|Save|Extension|Settings)$, class:^(cursor)$
# windowrulev2 = size 50% 60%, title:^(Open Folder|Select Folder|Save|Extension|Settings)$, class:^(cursor)$
# windowrulev2 = bordercolor $neon_green $neon_purple 45deg, title:^(Open Folder|Select Folder|Save|Extension|Settings)$, class:^(cursor)$
# windowrulev2 = rounding 10, title:^(Open Folder|Select Folder|Save|Extension|Settings)$, class:^(cursor)$

layerrule = blur on swaync-control-center
layerrule = blur on swaync-notification-window
# ignorezero and ignorealpha removed - not valid in 0.53
#

windowrule {
    name="cusor_dialogs"
    match:title = ^(Open Folder|Select Folder|Save|Extension|Settings)$
    match:class = ^(cursor)$
    size = 50% 60%
    border_color = $neon_green $neon_purple 45deg
    rounding = 10
}

# Screenshot selection rules - prevent windows from hiding
windowrule {
    name = "slurp"
    match:class = slurp
    no_focus = true
    float = true
    pin = true
    stay_focused = true
}

# -------------------------------------------------------------
# Smart Window Type Detection (Generic Patterns)
# -------------------------------------------------------------
# Note: These use complex matching conditions, keeping as windowrulev2

# Detect dialogs by window type
windowrulev2 = float, xwayland:1, title:^$  # Empty title XWayland dialogs
windowrulev2 = center, xwayland:1, title:^$

# Splash screens should float and center
windowrulev2 = float, class: .*, title:^(splash)$
windowrulev2 = center, class: .*, title:^(splash)$
windowrulev2 = noanim, class: .*, title:^(splash)$

# Pop-up windows (typically small utility windows)
# windowrulev2 = float, class: .*, title:^(pop-up)$
# windowrulev2 = float, class: .*, title:^(bubble)$
# windowrulev2 = float, class: .*, title:^(task_dialog)$
# windowrulev2 = float, class: .*, title:^(menu)$
# windowrulev2 = float, class: .*, title:^(dropdown.*)$

# Picture-in-Picture should always stay on top
# windowrulev2 = pin, title:^(Picture.in.[Pp]icture)$
# windowrulev2 = keepaspectratio, title:^(Picture.in.[Pp]icture)$
# windowrulev2 = float, title:^(Picture.in.[Pp]icture)$
# windowrulev2 = size 25% 25%, title:^(Picture.in.[Pp]icture)$
# windowrulev2 = move 74% 74%, title:^(Picture.in.[Pp]icture)$  # Bottom right corner

windowrule {
    name = "Popup"
    match:class = .*
    match:title = ^(pop-up|bubble|task_dialog|menu|dropdown.*)$
    float = true
}

windowrule {
    name = "PinP"
    match:title = ^(Picture.in.[Pp]icture)$
    keep_aspect_ratio = true
    no_focus = true
    size = 25% 25%
    move = 74% 74%
    float = true
    pin = true

}
