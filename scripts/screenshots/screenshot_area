#!/usr/bin/env bash
set -euo pipefail

DIR="${XDG_SCREENSHOTS_DIR:-${XDG_PICTURES_DIR:-$HOME/Pictures}}/Screenshots"
mkdir -p "$DIR"

FILE="$DIR/screenshot_area_$(date +'%Y-%m-%d_%H-%M-%S').png"

# Select area with slurp and capture with grim
if command -v slurp >/dev/null 2>&1; then
  GEOM="$(slurp -d)"
  if [ -n "$GEOM" ]; then
    grim -g "$GEOM" "$FILE"
  else
    notify-send -u low "Screenshot canceled"
    exit 0
  fi
else
  notify-send -u critical "slurp not found" "Install slurp to select area"
  exit 1
fi

# Copy to clipboard if available
if command -v wl-copy >/dev/null 2>&1; then
  wl-copy -t image/png < "$FILE"
  notify-send "Area screenshot saved" "$FILE
Copied to clipboard"
else
  notify-send "Area screenshot saved" "$FILE"
fi
